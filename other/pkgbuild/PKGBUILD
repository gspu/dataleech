pkgname=dataleech
pkgdesc='Dataleech - a backup plan using ZFS...'
pkgver=1.0.0
pkgrel=1
arch=('any')
url='https://github.com/xvzf/dataleech'
license=('GPL3')
depends=('zfs-utils' 'python' 'python-click' 'pv' 'openssh' 'cronie')
provides=('dataleech' 'superman')
backup=('etc/dataleech/datasets')
source=("git+https://github.com/xvzf/dataleech.git")
sha256sums=('SKIP')

build() {
  cd "${srcdir}/dataleech/"
  python setup.py build
}

package() {
  # Install dataleech
  cd "${srcdir}/dataleech/"
  python setup.py install --root="${pkgdir}" --optimize=1 --skip-build

  # Copy cronfiles
  mkdir -p ${pkgdir}/etc/{dataleech,cron.d}

  install -Dm644 "${srcdir}/other/datasets" \
                 "${pkgdir}/etc/dataleech/datasets"

  install -Dm644 "${srcdir}/other/cronfiles/dataleech.10min" \
                 "${pkgdir}/etc/cron.d/dataleech"

  install -Dm755 "${srcdir}/other/cronfiles/dataleech.daily" \
                 "${pkgdir}/etc/cron.daily/dataleech"

  install -Dm755 "${srcdir}/other/cronfiles/dataleech.weekly" \
                 "${pkgdir}/etc/cron.weekly/dataleech"

  # Copy the pacman wrapper superman
  install -Dm755 "${srcdir}/other/scripts/superman" \
                    "${pkgdir}/usr/bin/superman"
}

# vim:set ts=4 sts=2 sw=2 et:
